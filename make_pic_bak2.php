<?php require_once( $_SERVER['DOCUMENT_ROOT'] . "/" . "db_connect.php" ); ?><?php require_once( $_SERVER['DOCUMENT_ROOT'] . "/" . "state_list.php" ); ?><?php$user = mysqli_real_escape_string($conn, $_GET["user"]);$sql = "SELECT * FROM state_dataset WHERE user='" . $user . "';";$result = $conn->query($sql);$story = array();if ($result->num_rows > 0) {	while($row = $result->fetch_assoc()) {		foreach ($state_label as $id => $label) {			$this_label = $label;			if ($this_label == "D.C.") {				$this_label = "DC";			};			$this_label = str_replace(" ", "_", $this_label);			$row[$this_label] = trim($row[$this_label]);			if ($row[$this_label] != "") {				$story[$label] = $row[$this_label];			};		};	};} else {	$story["DC"] = "I did nothing.";};$conn->close();header("Content-Type: image/jpeg");//Set the image width and height$width = 600;$height = 315;$margin = 30;$font_size = 20;//$font_name = 'Capriola-Regular.ttf';$font_name = 'font_ComicSans.ttf';$font_name2 = 'font_Lithos_bold.otf';#$image = ImageCreate($width, $height);$image = imagecreatefromjpeg($_SERVER['DOCUMENT_ROOT'] . "/" . "pic_background3.jpg");$black = ImageColorAllocate($image, 0, 0, 0);$blue = ImageColorAllocate($image, 1, 131, 255);//Create the message$x = $margin;$y = $font_size;$lower_y_max = 240;$msg_final = '';$msg_final_array = array();foreach ($story as $state => $sentence) {		$msg = "In " . $state . ", " . $sentence;	$msg_array = explode(' ', $msg);	$msg_new = '';	foreach($msg_array as $word){		$copy_coor = imagettfbbox($font_size, 0, $font_name, $msg_new . ' ' . $word);		if($copy_coor[2] > $width - $margin * 2) {			$msg_new .= "\n     " . $word;		} else {			$msg_new .= " " . $word;		};	};	$msg_new = trim($msg_new);	$copy_coor = imagettfbbox($font_size, 0, $font_name, $msg_final . "\n" . $msg_new);	$lower_y = $y + $copy_coor[3];	if ($lower_y <= $lower_y_max) {		$msg_final = trim($msg_final . "\n\n" . $msg_new);	} else {		break;	};	};$copy_coor = imagettfbbox($font_size, 0, $font_name, $msg_final);$text_width = $copy_coor[2];$text_height = $copy_coor[3];$x = ($width - $text_width) / 2;$y = ($lower_y_max - $text_height + $font_size) / 2;imagettftext($image, $font_size, 0, $x, $y, $black, $font_name, $msg_final);imagettftext($image, $font_size, 0, $margin + 40, $height - ($font_size * 2.5), $black, $font_name2, "       SEE WHAT ELSE I'VE DONE, \n  AND SHARE YOUR OWN STORY!");imagejpeg($image, "user_img/" . $user . ".jpg");ImageJpeg($image);ImageDestroy($image);exit();?>